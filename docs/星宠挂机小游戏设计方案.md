好的，遵照您的要求，我将结合玩法复杂度和开发实现难度，制定分阶段开发计划，并将所有内容整合为一份完整、结构化的产品设计方案文档。

---

# **《星宠挂机》小游戏产品设计方案 V1.0**

## **1. 项目概述**

《星宠挂机》是一款基于潮玩宇宙现有生态的放置类区块链小游戏。其核心是通过“星宠”这一载体，结合“挂机收益”、“宠物融合”、“资源挑战”等玩法，构建一个兼具休闲性、收集性和策略性的轻量化游戏生态。项目旨在为潮玩宇宙主生态引流、提升用户粘性，并通过精密的数值经济模型实现平台收益与用户收益的平衡。

## **2. 核心设计目标**

- **用户侧**：零撸用户有稳定基础收益，付费用户有差异化成长空间，收集用户有稀有度追求。
- **平台侧**：通过 “资源消耗 - 循环 - 变现” 实现收益，控制货币超发，防范刷号 / 脚本漏洞。
- **生态侧**：衔接潮玩宇宙现有宝石 / 贝壳体系，降低用户认知成本，提升整体生态活跃度。

## **3. 玩法系统设计**

### **3.1. 核心玩法：星宠挂机养成**

#### **3.1.1. 星宠获取与稀有度体系**
- **稀有度分级**：普通（白）→ 稀有（蓝）→ 史诗（紫）→ 传说（橙）→ 神话（红）。
- **获取途径**：
  1.  **新手解锁**：注册实名认证后免费领取1只「普通星宠」。
  2.  **贝壳兑换**：通过“星宠商店”兑换「普通/稀有星宠蛋」（每日限购）。
  3.  **宝石购买**：使用宝石购买「史诗/传说星宠蛋」（周/月限购）。
  4.  **星宠融合**：3只同稀有度星宠 + 对应材料可融合为更高稀有度，存在成功率机制。
  5.  **邀请奖励**：成功邀请新用户可获得「稀有星宠蛋」。

#### **3.1.2. 挂机收益机制**
- **核心逻辑**：星宠消耗「能量」自动产出贝壳/宝石。离线收益按80%计算，离线上限12小时。
- **操作简化**：“开启挂机 - 补充能量 - 领取收益”三步操作，支持“自动补充能量”功能。
- **收益加成**：
  - **星宠等级**：每提升1级，收益提升5%（满级30级）。
  - **星宠羁绊**：收集同系星宠可激活全体收益加成。
  - **平台活动**：节假日开启限时“收益翻倍”等活动。

### **3.2. 辅助玩法：资源循环与社交粘性**

#### **3.2.1. 资源矿点挑战**
- **玩法规则**：矿点分5级，挑战需消耗“矿票”，产出宝石与贝壳。
- **收益设定**：净收益约为投入的1.2倍，鼓励用户参与。
- **限制机制**：每日挑战次数、单个矿点开启数量受限。

#### **3.2.2. 星宠融合与技能解锁**
- **融合规则**：
  | 目标稀有度 | 所需材料 | 所需宝石 | 成功率 | 失败损失 |
  | :--- | :--- | :--- | :--- | :--- |
  | 稀有 | 3只普通 | 5 | 80% | 1只普通 + 2宝石 |
  | 史诗 | 3只稀有 | 20 | 50% | 1只稀有 + 10宝石 |
  | 传说 | 3只史诗 | 100 | 20% | 1只史诗 + 50宝石 |
  | 神话 | 3只传说 + 1个神话核心 | 500 | 5% | 1只传说 + 200宝石 |
- **技能系统**：传说及以上星宠解锁专属技能，技能升级需消耗“技能石”。

#### **3.2.3. 社交助力**
- **助力规则**：每日可请好友助力，双方各得能量。
- **拉新奖励**：邀请新用户，邀请者可获稀有星宠蛋及被邀请者永久收益分成（平台补贴）。

## **4. 数值系统深度设计**

### **4.1. 货币体系**
| 货币类型 | 定位 | 主要获取途径 | 主要消耗途径 | 汇率锚定 |
| :--- | :--- | :--- | :--- | :--- |
| **宝石** | 硬通货（可变现） | 挂机、矿点、任务、充值 | 融合、买矿票、技能升级、交易手续费 | 1宝石 = 1.9元 |
| **贝壳** | 日常货币（不可变现） | 挂机、矿点、每日任务 | 买能量、换宠物蛋、买矿票 | 1宝石 = 250贝壳 |
| **能量** | 挂机资源（不可交易） | 自然恢复、好友助力、贝壳购买 | 挂机、挑战矿点 | 无 |

### **4.2. 星宠数值模型**
| 稀有度 | 基础日收益（宝石） | 等级成长系数 | 满级日收益 | 回本周期（按充值价） |
| :--- | :--- | :--- | :--- | :--- |
| 普通 | 0.1 | 5% | 0.43 | 无（免费） |
| 稀有 | 0.2 | 6% | 1.17 | 26天 |
| 史诗 | 0.4 | 8% | 3.84 | 52天 |
| 传说 | 0.8 | 10% | 9.68 | 125天 |
| 神话 | 1.5 | 12% | 25.35 | 333天 |

### **4.3. 能量与防刷控制**
- **基础规则**：挂机每小时消耗20能量，自然恢复10点/小时（上限100点）。
- **防刷机制**：
  - 能量不可交易。
  - 单设备每日最多登录2个账号。
  - 贝壳购买能量每日有上限。

### **4.4. 全平台产出调控**
- **动态上限**：设定每日全平台宝石产出上限，超出部分触发收益衰减。
- **监控与调控**：实时监控产出/消耗比，通过调整融合成功率、矿点周期等方式进行动态平衡。

### **4.5. 数值公式与计算细节**

- **符号约定**：
  - \(r_{base}\)：星宠基础产出速率（单位：宝石/小时）。示例：稀有为 0.2/h。
  - \(L\)：星宠等级（0-30），等级加成为 \(b_L = 0.05\times L\)。
  - \(b_S\)：羁绊加成（收集套系后获得的全局产出加成，示例：0.02、0.05 等可叠加）。
  - \(b_A\)：活动加成（节假日翻倍、限时 Buff 等临时系数）。
  - \(D\)：平台动态衰减系数（见下文平台上限衰减）。
  - \(\Delta t\)：计费周期时长（小时）。
  - 能量：消耗速率 \(c_E = 20\) 点/小时；自然恢复 \(r_E = 10\) 点/小时；上限 100 点。

- **有效产出速率**：
  \[ r_{eff} = r_{base} \times (1 + b_L + b_S + b_A) \times D \]

- **在线收益**（能量充足时）：
  \[ E_{online} = r_{eff} \times \Delta t \]

- **离线收益**（按 80% 结算，且离线时长封顶 12 小时）：
  \[ E_{offline} = r_{eff} \times \min(T_{offline}, 12) \times 0.8 \]

- **能量约束**：
  - 可挂机有效时长受当前能量与自然恢复共同约束。
  - 设当前能量为 \(E_0\)，在不购入能量情况下的可持续时长 \(T_{sustain}\) 近似解满足：
    \[ E_0 + r_E \times T_{sustain} = c_E \times T_{sustain} \Rightarrow T_{sustain} = \frac{E_0}{c_E - r_E} = \frac{E_0}{10} \]
  - 若开启“自动补能”，则在“贝壳购买能量”日上限内以固定汇率补能，超出上限后按无补能处理。

- **平台上限衰减（与 4.4 呼应）**：
  - 设每日全平台产出上限为 \(Q\)，实时累计产出为 \(P\)。
  - \(P \le Q\) 时，\(D = 1\)。\(P > Q\) 时：
    \[ D = \max\big(0.2,\; 1 - \alpha \cdot \frac{P - Q}{Q}\big) \]
    其中 \(\alpha\) 为调控强度（建议初始 0.5，可运营调参）。

- **结算与精度**：
  - 服务器端以分钟为最小结算粒度，所有产出向下取整到“最小货币单位”（宝石/贝壳分别以最小可分割单位计，前端显示做千分位与单位换算）。
  - 领取收益时计算区间内的在线与离线片段分段结算，统一在服务器汇总，防篡改。

### **4.6. 参数默认值与可调开关**

| 参数 | 默认值 | 范围 | 说明 |
| :--- | :---: | :---: | :--- |
| 离线结算系数 | 0.8 | 0.5-1.0 | 活动期可上调 |
| 离线上限 | 12h | 4-24h | 保障节奏与回流 |
| 能量消耗 | 20/h | 10-30/h | 影响付费深度 |
| 自然恢复 | 10/h | 5-20/h | 控制零撸体验 |
| 动态衰减下限 | 0.2 | 0.1-0.5 | 防止产出归零 |
| 衰减强度 \(\alpha\) | 0.5 | 0.2-1.0 | 产消比调控 |

### **4.7. 边界与异常处理**

- 能量不足：在线收益中断，仅保留自然恢复；“自动补能”打开且未达日上限时，优先消耗贝壳购能。
- 离线超过上限：按上限时长计算，超出部分丢弃。
- 频繁切换前后台：由服务器以心跳/心跳缺失判定在线段，防止伪在线刷产出。
- 服务器时间权威：所有时间戳、区间由服务器记录与签名，客户端仅做显示。

## **5. 收益保障与平台盈利模型**

### **5.1. 用户收益保障**
- **零撸用户**：月收益约8.55元，稳定可持续。
- **付费用户**：月收益约167.75元（以传说星宠为例），回本后长期盈利。
- **提现规则**：最低门槛10宝石，手续费10%，T+1到账。

### **5.2. 平台盈利模型**
- **宝石充值**：预估月收入19万元（基于10万活跃用户假设）。
- **交易手续费**：预估月收入28.5万元。
- **付费道具**：如加速卡、融合保护符，预估月收入38万元。
- **拉新成本优化**：通过游戏内道具激励，降低单用户拉新成本至38元。

## **6. 漏洞防范与风险控制**

- **账号安全**：实名认证、设备码绑定、IP异常检测。
- **数值安全**：收益上限、挑战冷却、失败惩罚。
- **经济安全**：固定汇率、货币销毁机制、异常行为预警与人工审核。
- **技术安全**：服务器端逻辑校验、行为模式分析AI风控。

## **7. 开发实施计划**

本计划采用**敏捷开发、分阶段上线**的策略，优先保障核心循环的跑通与稳定，逐步丰富游戏内容。

### **第一阶段：MVP (Minimum Viable Product) 核心闭环 (预计8-10周)**

**目标**：上线最核心的挂机、收益、兑换循环，验证经济模型基础，收集用户数据。
**核心功能**：
1.  **用户系统**：注册、登录、实名认证。
2.  **星宠基础**：普通星宠的获取、展示、基础信息。
3.  **挂机系统**：能量消耗与恢复、在线/离线收益计算与领取、自动补充能量。
4.  **商店与兑换**：使用贝壳兑换普通/稀有星宠蛋。
5.  **基础经济**：宝石、贝壳、能量的基础获取与消耗循环。
6.  **后台监控**：核心数据看板（用户数、在线时长、宝石/贝壳产出消耗量）。

**开发难度**：中等。核心难点在于**经济系统的服务器端逻辑**，需要保证收益计算的准确性和防篡改性。

**验收标准**：
- 完成注册/登录/实名认证闭环，异常流程（超时/重复/拒绝）可回退。
- 单只“普通星宠”可稳定产生在线/离线收益，能量消耗/恢复正确。
- 领取收益记录与账户余额一致，服务器日志可追溯到分钟级。
- 商店可用贝壳兑换普通/稀有宠物蛋，库存/限购规则生效。
- 数据看板具备“日活、在线时长、宝石/贝壳产消”基础图表。

**测试要点**：
- 时间旅行测试（模拟 12h 离线、断网恢复），边界值（0、上限、超上限）。
- 能量耗尽后产出是否停止；自动补能上限是否严格执行。
- 并发领取同一笔收益的幂等性；重复请求是否被拒绝。
- 反作弊：伪造客户端时间、跳变时钟是否无效。

---

### **第二阶段：内容扩展与社交 (预计6-8周)**

**目标**：增加游戏深度和粘性，引入社交裂变，提升留存和活跃。
**核心功能**：
1.  **星宠融合系统**：实现从普通到传说稀有度的融合逻辑与UI。
2.  **矿点挑战玩法**：矿点UI、挑战逻辑、周期产出计算。
3.  **社交助力系统**：好友列表、助力逻辑、邀请有奖功能。
4.  **任务与成就系统**：每日任务、新手任务、基础成就。
5.  **星宠等级系统**：升级逻辑与数值加成。

**开发难度**：中高。**融合系统**的规则和状态管理较为复杂；**矿点系统**涉及异步计时和奖励发放，需要健壮的后端服务支持。

**验收标准**：
- 融合 UI 与流程可达；成功/失败概率与消耗、回退一致；失败损失正确扣减。
- 矿点挑战具备入场校验、计时、掉线重连保障、奖励发放与结算回放。
- 社交助力每日次数/互惠规则可控且可追踪；邀请链路绑定可靠。
- 任务与成就具备配置化发布，客户端无需发版即可增改。

**测试要点**：
- 概率学测试：大量融合实验统计偏差在容许区间（例如 ±2%）。
- 异常流：挑战中断、网络抖动、断线重连；任务结算幂等。
- 社交系统风控：同设备/同 IP 批量助力、批量邀请拦截。

---

### **第三阶段：深度优化与商业化 (预计8-10周)**

**目标**：完善商业化变现，增加游戏终极目标，优化用户体验和系统稳定。
**核心功能**：
1.  **神话星宠与技能系统**：设计并实现神话星宠融合、技能库、技能升级逻辑。
2.  **进阶商业化**：
    - **付费道具**：加速卡、融合保护符等上架。
    - **月卡/特权卡**：订阅服务的设计与开发。
    - **外观系统**：星宠皮肤、场景皮肤（可优先级后置）。
3.  **高级数值调控**：实现“动态难度”系统，如“宇宙能量潮汐”。
4.  **高级风控与优化**：
    - 完善AI行为分析风控系统。
    - 数据监控与自动化调控策略。
    - 性能优化与服务器扩容。

**开发难度**：高。**技能系统**和**动态调控系统**设计复杂，需要精细的数值调试和测试。**AI风控**需要大数据支持和算法开发。

**验收标准**：
- 神话星宠与技能库可配置、可灰度；技能效果在 PVP/PVE 环境下稳定。
- 商业化付费道具链路完整（下单-回调-到账-风控），月卡/特权卡具备续费与到期逻辑。
- 动态调控（全局 Buff、衰减参数）可热更新，回滚安全。
- 风控策略可通过配置中心灰度发布，误杀率可控。

**测试要点**：
- 高并发压测：峰值 QPS 与延迟达标（见 12 章）。
- 回归测试：经济系统任何参数变更不会破坏基础闭环。
- 数据一致性：跨日、跨月结转的边界与汇总准确。

---

## **8. 总结**

《星宠挂机》小游戏设计方案，以精密数值经济模型为骨架，以轻量化和收集性玩法为血肉，旨在构建一个健康、可持续的游戏内循环。通过分三阶段的稳健开发计划，能够有效控制项目风险，逐步验证玩法与商业模式，最终实现提升潮玩宇宙整体生态活力与商业价值的战略目标。

---

## **9. 后端数据模型与 API 设计（概要）**

- **核心实体**：
  - 用户（User）：`userId`，实名认证状态，设备指纹。
  - 星宠（Pet）：`petId`，稀有度，等级，绑定用户，羁绊标签。
  - 资产（Wallet）：宝石余额、贝壳余额、不可交易能量。
  - 产出记录（ProductionLog）：时间段、在线/离线、产量、能量消耗。
  - 能量流水（EnergyLedger）：来源（自然/购买/助力）、去向（挂机/挑战）。
  - 蛋与背包（InventoryItem）：种类、数量、限购计数与重置时间。
  - 融合尝试（FusionAttempt）：材料列表、概率、结果、消耗。
  - 矿点挑战（MineChallenge）：矿点等级、入场票、开始/结束、掉落。
  - 任务/成就（Task/Achievement）：配置、进度、奖励。

- **鉴权**：JWT（短期）+ 设备指纹签名；关键写操作二次校验。

- **示例接口定义**：
  - Auth
    - POST `/api/auth/login`
      - Request:
```json
{ "phone": "string", "code": "string", "deviceId": "string" }
```
      - Response:
```json
{ "token": "jwt", "userId": "u_123", "needKYC": false }
```
  - 用户与资产
    - GET `/api/user/profile`
    - GET `/api/wallet/balance`
  - 星宠与挂机
    - GET `/api/pet/list`
    - POST `/api/afk/start`  // 开启或续期开挂（幂等）
```json
{ "petId": "p_1", "autoRefill": true }
```
    - POST `/api/afk/claim`  // 领取收益（服务器区间结算）
```json
{ "petId": "p_1" }
```
    - POST `/api/energy/buy`
```json
{ "amount": 50 }
```
  - 商店与兑换
    - GET `/api/shop/list`
    - POST `/api/shop/exchange`  // 用贝壳换宠物蛋
```json
{ "sku": "egg_rare", "quantity": 1 }
```
  - 融合
    - POST `/api/fusion/try`
```json
{ "targetRarity": "epic", "materials": ["p_a","p_b","p_c"], "useCharm": false }
```
  - 矿点
    - POST `/api/mine/enter`
```json
{ "spot": 3 }
```
    - POST `/api/mine/claim`
```json
{ "challengeId": "mc_1" }
```
  - 社交
    - POST `/api/social/assist`
```json
{ "friendId": "u_456" }
```
    - POST `/api/invite/bind`
```json
{ "inviteCode": "ABCD12" }
```
  - 监控
    - GET `/api/metrics/overview`（管理端）

> 所有写操作返回结构统一包含：`requestId`、`serverTime`、`signature`，客户端落库校对。

---

## **10. 前端架构与页面流程（与现有仓库映射）**

- **应用骨架**：
  - 路由：`src/router/index.tsx`
  - 布局：`src/components/layout/Layout.tsx`、`Navbar.tsx`
  - 状态：`src/store/gameStore.ts`、`userStore.ts`、`shopStore.ts`、`inviteStore.ts`

- **页面与模块映射**：
  - 挂机主页：`src/pages/game/GamePage.tsx`
    - 组件：`ClickButton.tsx`、`GameStats.tsx`、`UpgradeList.tsx`、`AchievementList.tsx`
    - 新增建议：能量条、自动补能开关、离线收益弹窗。
  - 商店：`src/pages/shop/ShopPage.tsx`
    - 组件：`ShopItems.tsx`、`ShoppingCart.tsx`、`OrderHistory.tsx`
    - 新增建议：限购标识、倒计时、库存角标。
  - 订单：`OrderListPage.tsx`、`OrderDetailPage.tsx`
  - 邀请/社交：`InviteRecordsPage.tsx`，`profile/components/InviteSection.tsx`
  - 个人中心：`ProfilePage.tsx`，`UserProfileCard.tsx`、`ShareModal.tsx`、`OrderStatus.tsx`、`MenuList.tsx`

- **典型用户流**：
  1. 登录/实名 → 领取普通星宠 → 开启挂机（可开自动补能）。
  2. 次日回流 → 领取离线收益 → 用贝壳换蛋 → 收集羁绊加成。
  3. 中期 → 参与矿点 → 融合升阶 → 解锁活动 Buff。

---

## **11. 监控、反作弊与安全落地**

- **监控指标**：DAU、留存（D1/W1/M1）、在线时长分布、产出/消耗比、融合尝试/成功率、矿点参与率、邀请转化率、KYC 通过率、提现金额与通过率。
- **反作弊策略**：
  - 设备/账号绑定；同设备当日账号上限；IP 段异常告警。
  - 客户端关键事件双通道上报（前端 + 服务端校验），签名与时序检查。
  - 行为特征建模：节律性点击、24h 连续操作、并行任务异常；灰度封禁与人工审核队列。
  - 经济风控：大额合并提现限速/分批；异常产出自动降权。
- **安全措施**：
  - 所有结算在服务器侧；客户端仅作展示。
  - 关键接口限流与重放保护（`nonce` + 过期时间 + 签名）。

---

## **12. 测试与发布目标**

- **性能基线（MVP）**：
  - 峰值请求：3k QPS（读取型 80%），P95 延迟 < 120ms，错误率 < 0.3%。
  - 任务型接口（结算/融合/挑战）P95 < 300ms，幂等保障。
- **数据一致性**：跨天结转任务/限购/离线收益对账误差 = 0。
- **发布流程**：开发 → 联调 → 预发布（灰度 5% DAU）→ 全量；出现异常一键回滚。

---

## **13. 风险清单与缓解**

- 数值通胀：平台上限衰减 + 活动期限定投放 + 及时回收（矿票/技能石）。
- 脚本与工作室：设备/IP/行为多信道校验，经济阈值触发人工审核。
- 兑换挤兑：提现门槛与手续费动态调节，排队与额度管控。
- 合规与支付：KYC/KYB 完整链路，资金托管与风控策略同步法务评审。

---

## **14. 数值仿真样例（简）**

- 条件：稀有星宠（`r_base=0.2`）、等级 10（\(b_L=0.5\)）、无羁绊（\(b_S=0\)）、无活动（\(b_A=0\)）、\(D=1\)。
- 有效速率：\(r_{eff} = 0.2 \times (1+0.5) = 0.3\) 宝石/小时。
- 在线 3 小时：\(E_{online}=0.9\)；离线 10 小时：\(E_{offline}=0.3\times10\times0.8=2.4\)。
- 当日合计 ≈ 3.3 宝石；若叠加 5% 羁绊与 20% 活动：\(r_{eff}=0.2\times(1+0.5+0.05+0.2)=0.35\)，收益相应提升。

---

## **15. 术语表**

- 宝石（Gem）：可变现硬通货；
- 贝壳（Shell）：不可变现日常货币；
- 能量（Energy）：挂机/挑战资源，不可交易；
- 羁绊（Bond）：同系星宠收集后触发的全局加成；
- 动态衰减（Dynamic Decay）：平台产出超过上限后的全局系数下调。

---

## **16. 变更记录**

- V1.1（本次）：新增数值公式细化、阶段验收与测试要点、后端数据模型与 API 概要、前端映射、监控与风控、风险清单、仿真样例、术语与变更记录。